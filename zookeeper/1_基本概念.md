## 1. 简单介绍下zookeeper
ZooKeeper（注：ZooKeeper是著名Hadoop的一个子项目，是一个**开源的分布式协调服务，旨在解决大规模分布式应用场景下，服务协调同步（Coordinate Service）的问题**；
它可以为同在一个分布式系统中的其他服务提供：**统一命名服务、配置管理、分布式锁服务、leader选举、集群管理等功能**。

ZooKeeper 是一个典型的**分布式数据一致性**的解决方案，致力于提供一个高性能、高可用、具有严格的顺序访问控制能力的分布式协调服务，具有如下分布式一致性特性：
* **顺序一致性**：从同一个客户端发起的事务请求，最终将会严格地按照其发起顺序被应用到ZooKeeper中去。
* **原子性**：要么整个集群所有机器都成功应用了某一个事务，要么都没有应用，一定不会出现集群中部分机器应用了该事务，而另外一部分没有应用的情况。
* **单一视图**：无论客户端连接的是哪个ZooKeeper服务器，其看到的服务端数据模型都是一致的。
* **可靠性**：一旦服务端成功地应用了一个事务，并完成对客户端的响应，那么该事务所引起的服务端状态变更将会被一直保留下来，除非有另一个事务又对其进行了变更。
* **实时性**：ZooKeeper仅仅保证在一定的时间段内，客户端最终一定能够从服务端上读取到最新的数据状态。

由于**zookeeper将全量的数据存储在内存中，并直接服务于客户端的所有非事务请求，因此它尤其适用于以读操作为主的场景**。  
客户端的读请求可以被集群中的任意一台机器处理，如果读请求在节点上注册了监听器，这个监听器也是由所连接的 zookeeper 机器来处理。
**对于写请求，这些请求会同时发给其他 zookeeper 机器并且达成一致后，请求才会返回成功**。因此，随着 zookeeper 的集群机器增多，读请求的吞吐会提高但是写请求的吞吐会下降。

有序性是 zookeeper 中非常重要的一个特性，**所有的更新都是全局有序的，每个更新都有一个唯一的时间戳，这个时间戳称为 zxid**（Zookeeper Transaction Id）。而读请求只会相对于更新有序，
也就是读请求的返回结果中会带有这个zookeeper 最新的 zxid。

## 2. Zookeeper 文件系统
Zookeeper 提供一个多层级的节点命名空间（节点称为 znode）。与文件系统不同的是，这些**节点都可以设置关联的数据**，而文件系统中只有文件节点可以存放数据而目录节点不行。  
Zookeeper 为了保证高吞吐和低延迟，**在内存中维护了这个树状的目录结构，这种特性使得 Zookeeper 不能用于存放大量的数据，每个节点的存放数据上限为1M**。

## 3. 服务器角色？
#### Leader
（1）事务请求的唯一调度和处理者，保证集群事务处理的顺序性  
（2）集群内部各服务的调度者  

#### Follower
（1）处理客户端的非事务请求，转发事务请求给 Leader 服务器  
（2）参与事务请求 Proposal 的投票  
（3）参与 Leader 选举投票  

#### Observer
（1）3.0 版本以后引入的一个服务器角色，**在不影响集群事务处理能力的基础上提升集群的非事务处理能力**  
（2）处理客户端的非事务请求，转发事务请求给 Leader 服务器  
（3）不参与任何形式的投票  

## 4. Zookeeper的节点有哪几种类型？
Zookeeper的数据存储结构就像一棵树，这棵树由节点组成，这种节点叫做Znode。Znode分为四种类型：  
1. 持久节点 （PERSISTENT）
默认的节点类型。该数据节点被创建后，会一直存在于zookeeper服务器上，直到有删除操作来主动清除这个节点；

2. 持久节点顺序节点（PERSISTENT_SEQUENTIAL）
所谓顺序节点，就是在创建节点时，Zookeeper会自动在节点名后面追加一个整形数字，这个整型数字是一个由父节点维护的自增数字； 

3. 临时节点（EPHEMERAL）
**临时节点的生命周期和客户端的会话绑定在一起**。和持久节点相反，当创建节点的客户端与zookeeper断开连接后，临时节点会被删除；zookeeper规定了不能基于临时节点来创建子节点，即**临时节点只能作为叶子节点**；

4. 临时顺序节点（EPHEMERAL_SEQUENTIAL）
顾名思义，临时顺序节点结合和临时节点和顺序节点的特点：在创建节点时，Zookeeper根据创建的时间顺序给该节点名称进行编号；当创建节点的客户端与zookeeper断开连接后，临时节点会被删除。
